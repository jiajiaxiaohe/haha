<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./css/public.css">
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/shopcar.css">
    <title>Document</title>
</head>
<body>
        <div id="title">
                <div class="margin">
                <div class="til-l">
                    <em>Hello , Welcom To OJO眼镜！</em>
                    <a href="login.html" class="login">登录</a>
                    <span>|</span>
                    <a href="#">注册</a>
                    <span>|</span>
                    <a href="index.html">首页</a>
                </div>
                <div class="til-r">
                    <img src="images/goshop1.png" alt="">
                    <a href="#">购物车</a>
                    <em>0</em>
                    <a href="#"class="jie">去结算</a>
                    <span>|</span>
                    <img src="images/phone.png" />
                    <a href="#" class="wx">手机版</a>
                    <span>|</span>
                    <a href="#">帮助中心</a>
                    <span>|</span>
                    <img src="images/phone.png" alt="">
                    <a href="#">最新消息</a>
                    <img src="" alt="">
                    <i></i>
                    <img src="images/weixin1.png" alt="" class="wx1">
                </div>
            </div>
        </div>
        <header >
            <div class="margin lo">
                <a href="" class="logo1"><img src="./images/logo.png" alt=""></a>
                <a href="" class="logo2"></a>
        </header>
        <h3 class="margin">我的购物车</h3>
        <table class="margin" border="1" cellspacing="0" width="900" align="center">
            <thead>
                <tr>
                    <th>选择</th>
                    <th>图片</th>
                    <th>详情</th>
                    <th>单价</th>
                    <th>数量</th>
                    <th>金额</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="6">目前购物车为空....</td>

                </tr>
            </tbody>
        </table>


        <div class="margin">
            <div class="shop">
                <a href="list.html" class="ag"></a>
                <a href="#" class="aj"></a>
            </div>
        </div>
        <div id="tel">
            <div class="margin">
            <div class="tel-t">
               <dl class="ke">
                   <dt>客服热线</dt>
                   <dd><a href="#">免责申明</a></dd>
                   <dd><a href="#">免责刹车申明</a></dd>
                   <dd><a href="#">免责申明</a></dd>
                   <dd><a href="#">免责申明</a></dd>
               </dl>
               <dl>
                <dt>关于OJO眼镜</dt>
                <dd><a href="#">免责申明</a></dd>
                <dd><a href="#">免责而我却申明</a></dd>
                <dd><a href="#">免责申明</a></dd>
                <dd><a href="#">免责申明</a></dd>
               
            </dl>
            <dl>
                <dt>售后服务</dt>
                <dd><a href="#">免责申明</a></dd>
                <dd><a href="#">免责申明</a></dd>
                <dd><a href="#">免责而我却申明</a></dd>
                <dd><a href="#">免责申明</a></dd>
            </dl>
            <dl>
                <dt>帮助中心</dt>
                <dd><a href="#">免责申我去明</a></dd>
                <dd><a href="#">免责申明</a></dd>
                <dd><a href="#">免责申明</a></dd>
                <dd><a href="#">免责申明</a></dd>
            </dl>
            <dl>
                <dt>关于OJO眼镜</dt>
                <dd><a href="#">免责申明</a></dd>
                <dd><a href="#">免责申明</a></dd>
                <dd><a href="#">免责上千万申明</a></dd>
                <dd><a href="#">免责申明</a></dd>
            </dl>
            <dl>
                <dt>关于OJO眼镜</dt>
                <dd><a href="#">免责申趣味他我去明</a></dd>
                <dd><a href="#">免责申明</a></dd>
                <dd><a href="#">免责申明</a></dd>
                <dd><a href="#">免责申明</a></dd>
            </dl>
            <dl class="ha">
                <dt>微信公众号</dt>
                <dd class="ma"></dd>            
                <dd><a href="#">随州扫一扫，优惠盛会多</a></dd>
            </dl>
            </div>
        </div>
    </div>
    <div id="sj" class="margin">
        <div class="cha">
            <input type="text" placeholder="请输入您的电子邮箱" class="txt">
            <input type="button" value="订阅" class="btn">
        </div>
        <div class="zfb">
            <a href="#" class="ic1"></a>
            <a href="#" class="ic2"></a>
            <a href="#" class="ic3"></a>
            <a href="#" class="ic4"></a>
            <a href="#" class="ic5"></a>
        </div>
    </div>
    
    <footer>
        <div class="footer-d">
            <a href="#">OJO首页</a>
            <span>|</span>
            <a href="#">眼镜知识</a>
            <span>|</span>
            <a href="#">框架眼镜</a>
            <span>|</span>
            <a href="#">太阳眼镜</a>
            <span>|</span>
            <a href="#">眼镜片</a>
            <span>|</span>
            <a href="#">友情链接</a>
            <span>|</span>
            <a href="#">联系我们</a>
            <span>|</span>
            <a href="#">投诉建议</a>
            <span>|</span>
            <a href="#">网站地图</a>
        </div>
        <p>© 2005-2019 OJO眼镜网 版权所有，并保留所有权利。</p>
        <p>E-mail: service@o-j-o.cn</p>
        <p>ICP备案证书号:苏ICP备14046264号-1</p>
    </footer>
</body>
<script src="js/ajax.js"></script>
<script>
    class Car{
        constructor(){
            this.tbody = document.querySelector("tbody");
            this.url = "http://localhost/demo/data/goods6.json";
            this.init();
            // 1.删除：绑定删除按钮的事件
            this.addEvent();
            
        }

        addEvent(){
            var that = this;
            this.tbody.onclick = function(){
                if(event.target.className == "del"){
                    // 2.获取点击商品的id
                    that.id = event.target.parentNode.getAttribute("index");
                    // 3.删除DOM元素
                    event.target.parentNode.remove();
                    // 4.删除localstorage的数据
                    that.setData(function(i){
                        that.goods.splice(i,1);
                    });
                }
            }
            this.tbody.addEventListener("click",function(even){
                let e=even || window.event;
                let target=e.target || e.srcElement;
                if(target.className=="check"){
                    console.log(target)
                    that.num();
                }
                if(target.className=="num"){
                    that.num();
                }
            })
            this.tbody.oninput = function(){
                if(event.target.className == "changeNum"){
                    that.id = event.target.parentNode.parentNode.getAttribute("index");
                    // 10.修改localstorage的数据
                    that.setData(function(i){
                        that.goods[i].num = event.target.value;
                    });
                }
            }
        }
        setData(callback){
            for(var i=0;i<this.goods.length;i++){
                if(this.goods[i].id == this.id){
                    callback(i);
                }
            }
            localStorage.setItem("goods",JSON.stringify(this.goods));
        }
        
        init(){
            var that = this;
            ajaxPost(this.url,function(res){
                that.res = JSON.parse(res)
                that.getData();
                that.num();
            })
        }
        getData(){
            this.goods = localStorage.getItem("goods") ? JSON.parse(localStorage.getItem("goods")) : [];

            this.display();    
        }
        display(){
            var str = "";
            for(var i=0;i<this.res.length;i++){
                for(var j=0;j<this.goods.length;j++){
                    if(this.res[i].goodsId == this.goods[j].id){
                        str += `<tr index="${this.res[i].goodsId}">
                                    <td><input type="checkbox" class="check" checked/></td>
                                    <td><img src="${this.res[i].src}" alt=""></td>
                                    <td class="name">${this.res[i].name}</td>
                                    <td class="pri">${this.res[i].price}</td>
                                    <td><input class="num" type="number" value="${this.goods[j].num}" min=1 class="changeNum"></td>
                                    <td>${this.res[i].price.substr(1)*1*this.goods[j].num}</td>
                                    <td class="del">删除</td>
                                </tr>`
                    }
                }
            }
            str+=`<tr>
                    <td><input type="checkbox" checked/></td>
                    <td></td>
                    <td> </td>
                    <td ></td>
                    <td>总价</td>
                    <td class="cont"></td>
                    <td></td>
                </tr>`
            this.tbody.innerHTML = str;
        }
        num(){
            this.check=document.getElementsByClassName("check");
            this.cont=document.getElementsByClassName("cont");
            
            // console.log(this.check)
            var count=0;
            for(var i=0;i<this.check.length;i++){
                let p=this.check[i].parentNode.nextElementSibling.nextElementSibling.nextElementSibling
                let n=p.innerHTML.substr(1)*p.nextElementSibling.children[0].value;
                if(this.check[i].checked==true){
                    // console.log(count)
                    count+= p.innerHTML.substr(1)*p.nextElementSibling.children[0].value;
                }
                p.nextElementSibling.nextElementSibling.innerHTML=n;
                console.log(p.nextElementSibling.nextElementSibling.innerHTML)

            }
            this.cont[0].innerHTML=count;
        }
      
    }
    
    new Car;
    
</script>
</html>